# Сервис чата (Chat Service)

Сервис чата предоставляет API для создания чатов, отправки сообщений и получения сообщений в реальном времени через gRPC.

## Функциональность

- Создание новых чатов с несколькими участниками
- Отправка сообщений в чаты
- Получение сообщений в реальном времени через серверный стрим
- Аутентификация через сервис аутентификации (Auth Service)

## Структура проекта

```
/chat-service
├── api/proto          # Протофайлы и сгенерированный код
├── cmd                # Точка входа в приложение
├── internal
│   ├── api           # Обработчики gRPC запросов
│   ├── app           # Инициализация и запуск приложения
│   ├── middleware    # Промежуточное ПО (аутентификация)
│   ├── migrations    # SQL миграции
│   ├── models        # Модели данных
│   ├── repository    # Интерфейсы и реализация хранилища данных
│   └── service       # Бизнес-логика
└── database          # База данных SQLite
```

## Зависимости

- Go 1.24+
- gRPC
- SQLite
- Auth Service (для аутентификации)

## Настройка и запуск

### Предварительные требования

1. Установленный Go 1.24 или выше
2. Запущенный сервис аутентификации (Auth Service)

### Установка зависимостей

```bash
go mod download
```

### Настройка переменных окружения

Создайте файл `.env` в корне проекта со следующим содержимым:

```
GRPC_PORT=50052
SQLITE_PATH=./database/chat.db
AUTH_SERVICE_ADDR=localhost:50051
```

### Создание базы данных

```bash
mkdir -p database
sqlite3 database/chat.db < internal/migrations/20250416100120_chats_and_messages.sql
```

### Запуск сервиса

```bash
go run cmd/main.go
```

## Взаимодействие с сервисом

Сервис предоставляет следующие gRPC методы:

- `CreateChat` - создание нового чата
- `ConnectChat` - подключение к чату для получения сообщений
- `SendMessage` - отправка сообщения в чат

Для взаимодействия с сервисом необходимо передавать токен доступа в заголовке `authorization` в формате `Bearer <token>`.

## Взаимодействие с Auth Service

Чат-сервис взаимодействует с сервисом аутентификации для:

1. Проверки токенов доступа
2. Получения информации о пользователях

Взаимодействие происходит через gRPC клиент, который подключается к Auth Service по адресу, указанному в переменной окружения `AUTH_SERVICE_ADDR`.
